# MSIX\src
# Copyright (C) 2017 Microsoft
# Created by Phil Smith (psmith@microsoft.com) on 10/19/2017

cmake_minimum_required(VERSION 3.1.0 FATAL_ERROR)
ADD_CUSTOM_TARGET(SRC)

set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} ${CMAKE_CURRENT_SOURCE_DIR}/../cmake) # main (top) cmake dir
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/inc)

add_subdirectory(msix)
add_subdirectory(makemsix)

ADD_DEPENDENCIES(makemsix msix)

# Create header for BlockMap schemas

file(READ "${CMAKE_PROJECT_ROOT}/certs/base64_MSFT_RCA_2010.cer"  BASE64_MSFT_RCA_2010)
file(READ "${CMAKE_PROJECT_ROOT}/certs/base64_MSFT_RCA_2011.cer"  BASE64_MSFT_RCA_2011)
file(READ "${CMAKE_PROJECT_ROOT}/certs/base64_STORE_PCA_2011.cer" BASE64_STORE_PCA_2011)
file(READ "${CMAKE_PROJECT_ROOT}/certs/base64_Windows_Production.cer" BASE64_WINDOWS_PRODUCTION)
file(READ "${CMAKE_PROJECT_ROOT}/certs/base64_Windows_Production_PCA_2011.cer" BASE64_WINDOWS_PRODUCTION_PCA_2011)
file(READ "${CMAKE_PROJECT_ROOT}/certs/Microsoft_MarketPlace_PCA_2011.cer" BASE64_MSFT_MARKETPLACE_CA_G_016)

set(APPX_CERTS "// This file is generated by CMake and contains certs for parsing the AppxBlockMap.xml. Do not edit!!
#include <string>
#include <vector>

namespace MSIX {

// Do not alter the order of these certificates -- they are in chain order
std::vector<std::string> appxCerts = {
R\"(${BASE64_MSFT_RCA_2010})\",
R\"(${BASE64_WINDOWS_PRODUCTION_PCA_2011})\",
R\"(${BASE64_MSFT_RCA_2011})\",
R\"(${BASE64_STORE_PCA_2011})\",
R\"(${BASE64_MSFT_MARKETPLACE_CA_G_016})\",
R\"(${BASE64_WINDOWS_PRODUCTION})\",
};

}")
file(WRITE "${CMAKE_PROJECT_ROOT}/src/inc/AppxCerts.hpp" "${APPX_CERTS}")

